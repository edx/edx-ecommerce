define([
        'jquery',
        'underscore',
        'underscore.string',
        'backbone',
        'moment',
        'text!templates/course_list.html',
        'dataTablesBootstrap'
      ],
      function ($, _, _s, Backbone, moment, courseListViewTemplate) {

        'use strict';

        return Backbone.View.extend({

            el: '#course-list-view',

            template: _.template(courseListViewTemplate),

            initialize: function (options) {
                this.listenTo(this.collection, 'add remove change', this.render);
                this.collection.fetch();
            },

            renderCourseTable: function () {

                var tableData = [],
                    filterPlaceholder = gettext('Filter by org or course ID'),
                    $emptyLabel = '<label class="sr">' + filterPlaceholder + '</label>';

                this.collection.each(function (value) {
                    tableData.push(
                        {
                            id: value.get('id'),
                            name: value.get('name'),
                            last_edited: moment(value.get('last_edited')).format('MMMM DD, YYYY, h:mm A')
                        }
                    );
                });

                if (!$.fn.dataTable.isDataTable('#courseTable')) {

                    this.$el.find('#courseTable').DataTable({
                        autoWidth: false,
                        data: tableData,
                        info: false,
                        paging: false,
                        oLanguage: {
                            sSearch: ''
                        },
                        columns: [
                            {
                                title: gettext('ID'),
                                data: 'id',
                                fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                    $(nTd).html(_s.sprintf('<a href=\'/courses/%s\'>%s</a>', oData.id, oData.id));
                                }
                            },
                            {
                                title: gettext('Name'),
                                data: 'name'
                            },
                            {
                                title: gettext('Last Edited'),
                                data: 'last_edited'
                            }
                        ]
                    });

                    // NOTE: #courseTable_filter is generated by dataTables
                    this.$el.find('#courseTable_filter label').prepend($emptyLabel);

                    this.$el.find('#courseTable_filter input')
                        .attr('placeholder', filterPlaceholder)
                        .addClass('field-input input-text')
                        .removeClass('form-control input-sm');

                }
            },

            render: function () {

                this.$el.html(this.template);
                this.renderCourseTable();

                return this;
            }

        });
    }
);
